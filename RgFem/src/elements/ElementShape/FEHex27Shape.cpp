#include "FEHex27Shape.h"

//=============================================================================
//              H E X 2 7
//=============================================================================
// Lookup table for 27-node hex that maps a node index into a triplet that identifies
// the shape functions.
static int HEX27_LUT[27][3] = {
	{ 0,0,0 },
	{ 1,0,0 },
	{ 1,1,0 },
	{ 0,1,0 },
	{ 0,0,1 },
	{ 1,0,1 },
	{ 1,1,1 },
	{ 0,1,1 },
	{ 2,0,0 },
	{ 1,2,0 },
	{ 2,1,0 },
	{ 0,2,0 },
	{ 2,0,1 },
	{ 1,2,1 },
	{ 2,1,1 },
	{ 0,2,1 },
	{ 0,0,2 },
	{ 1,0,2 },
	{ 1,1,2 },
	{ 0,1,2 },
	{ 2,0,2 },
	{ 1,2,2 },
	{ 2,1,2 },
	{ 0,2,2 },
	{ 2,2,0 },
	{ 2,2,1 },
	{ 2,2,2 }
};

//-----------------------------------------------------------------------------
//! values of shape functions
void FEHex27::shape_fnc(double* H, double r, double s, double t)
{
	double R[3] = { 0.5*r*(r - 1.0), 0.5*r*(r + 1.0), 1.0 - r*r };
	double S[3] = { 0.5*s*(s - 1.0), 0.5*s*(s + 1.0), 1.0 - s*s };
	double T[3] = { 0.5*t*(t - 1.0), 0.5*t*(t + 1.0), 1.0 - t*t };

	H[0] = R[0] * S[0] * T[0];
	H[1] = R[1] * S[0] * T[0];
	H[2] = R[1] * S[1] * T[0];
	H[3] = R[0] * S[1] * T[0];
	H[4] = R[0] * S[0] * T[1];
	H[5] = R[1] * S[0] * T[1];
	H[6] = R[1] * S[1] * T[1];
	H[7] = R[0] * S[1] * T[1];
	H[8] = R[2] * S[0] * T[0];
	H[9] = R[1] * S[2] * T[0];
	H[10] = R[2] * S[1] * T[0];
	H[11] = R[0] * S[2] * T[0];
	H[12] = R[2] * S[0] * T[1];
	H[13] = R[1] * S[2] * T[1];
	H[14] = R[2] * S[1] * T[1];
	H[15] = R[0] * S[2] * T[1];
	H[16] = R[0] * S[0] * T[2];
	H[17] = R[1] * S[0] * T[2];
	H[18] = R[1] * S[1] * T[2];
	H[19] = R[0] * S[1] * T[2];
	H[20] = R[2] * S[0] * T[2];
	H[21] = R[1] * S[2] * T[2];
	H[22] = R[2] * S[1] * T[2];
	H[23] = R[0] * S[2] * T[2];
	H[24] = R[2] * S[2] * T[0];
	H[25] = R[2] * S[2] * T[1];
	H[26] = R[2] * S[2] * T[2];
}

//-----------------------------------------------------------------------------
//! values of shape function derivatives
void FEHex27::shape_deriv(double* Hr, double* Hs, double* Ht, double r, double s, double t)
{
	double R[3] = { 0.5*r*(r - 1.0), 0.5*r*(r + 1.0), 1.0 - r*r };
	double S[3] = { 0.5*s*(s - 1.0), 0.5*s*(s + 1.0), 1.0 - s*s };
	double T[3] = { 0.5*t*(t - 1.0), 0.5*t*(t + 1.0), 1.0 - t*t };

	double DR[3] = { r - 0.5, r + 0.5, -2.0*r };
	double DS[3] = { s - 0.5, s + 0.5, -2.0*s };
	double DT[3] = { t - 0.5, t + 0.5, -2.0*t };

	Hr[0] = DR[0] * S[0] * T[0]; Hs[0] = R[0] * DS[0] * T[0]; Ht[0] = R[0] * S[0] * DT[0];
	Hr[1] = DR[1] * S[0] * T[0]; Hs[1] = R[1] * DS[0] * T[0];	Ht[1] = R[1] * S[0] * DT[0];
	Hr[2] = DR[1] * S[1] * T[0]; Hs[2] = R[1] * DS[1] * T[0];	Ht[2] = R[1] * S[1] * DT[0];
	Hr[3] = DR[0] * S[1] * T[0]; Hs[3] = R[0] * DS[1] * T[0];	Ht[3] = R[0] * S[1] * DT[0];
	Hr[4] = DR[0] * S[0] * T[1]; Hs[4] = R[0] * DS[0] * T[1];	Ht[4] = R[0] * S[0] * DT[1];
	Hr[5] = DR[1] * S[0] * T[1]; Hs[5] = R[1] * DS[0] * T[1];	Ht[5] = R[1] * S[0] * DT[1];
	Hr[6] = DR[1] * S[1] * T[1]; Hs[6] = R[1] * DS[1] * T[1];	Ht[6] = R[1] * S[1] * DT[1];
	Hr[7] = DR[0] * S[1] * T[1]; Hs[7] = R[0] * DS[1] * T[1];	Ht[7] = R[0] * S[1] * DT[1];
	Hr[8] = DR[2] * S[0] * T[0]; Hs[8] = R[2] * DS[0] * T[0];	Ht[8] = R[2] * S[0] * DT[0];
	Hr[9] = DR[1] * S[2] * T[0]; Hs[9] = R[1] * DS[2] * T[0];	Ht[9] = R[1] * S[2] * DT[0];
	Hr[10] = DR[2] * S[1] * T[0]; Hs[10] = R[2] * DS[1] * T[0];	Ht[10] = R[2] * S[1] * DT[0];
	Hr[11] = DR[0] * S[2] * T[0]; Hs[11] = R[0] * DS[2] * T[0];	Ht[11] = R[0] * S[2] * DT[0];
	Hr[12] = DR[2] * S[0] * T[1]; Hs[12] = R[2] * DS[0] * T[1];	Ht[12] = R[2] * S[0] * DT[1];
	Hr[13] = DR[1] * S[2] * T[1]; Hs[13] = R[1] * DS[2] * T[1];	Ht[13] = R[1] * S[2] * DT[1];
	Hr[14] = DR[2] * S[1] * T[1]; Hs[14] = R[2] * DS[1] * T[1];	Ht[14] = R[2] * S[1] * DT[1];
	Hr[15] = DR[0] * S[2] * T[1]; Hs[15] = R[0] * DS[2] * T[1];	Ht[15] = R[0] * S[2] * DT[1];
	Hr[16] = DR[0] * S[0] * T[2]; Hs[16] = R[0] * DS[0] * T[2];	Ht[16] = R[0] * S[0] * DT[2];
	Hr[17] = DR[1] * S[0] * T[2]; Hs[17] = R[1] * DS[0] * T[2];	Ht[17] = R[1] * S[0] * DT[2];
	Hr[18] = DR[1] * S[1] * T[2]; Hs[18] = R[1] * DS[1] * T[2];	Ht[18] = R[1] * S[1] * DT[2];
	Hr[19] = DR[0] * S[1] * T[2]; Hs[19] = R[0] * DS[1] * T[2];	Ht[19] = R[0] * S[1] * DT[2];
	Hr[20] = DR[2] * S[0] * T[2]; Hs[20] = R[2] * DS[0] * T[2];	Ht[20] = R[2] * S[0] * DT[2];
	Hr[21] = DR[1] * S[2] * T[2]; Hs[21] = R[1] * DS[2] * T[2];	Ht[21] = R[1] * S[2] * DT[2];
	Hr[22] = DR[2] * S[1] * T[2]; Hs[22] = R[2] * DS[1] * T[2];	Ht[22] = R[2] * S[1] * DT[2];
	Hr[23] = DR[0] * S[2] * T[2]; Hs[23] = R[0] * DS[2] * T[2];	Ht[23] = R[0] * S[2] * DT[2];
	Hr[24] = DR[2] * S[2] * T[0]; Hs[24] = R[2] * DS[2] * T[0];	Ht[24] = R[2] * S[2] * DT[0];
	Hr[25] = DR[2] * S[2] * T[1]; Hs[25] = R[2] * DS[2] * T[1];	Ht[25] = R[2] * S[2] * DT[1];
	Hr[26] = DR[2] * S[2] * T[2]; Hs[26] = R[2] * DS[2] * T[2];	Ht[26] = R[2] * S[2] * DT[2];
}

//-----------------------------------------------------------------------------
//! values of shape function second derivatives
void FEHex27::shape_deriv2(double* Hrr, double* Hss, double* Htt, double* Hrs, double* Hst, double* Hrt, double r, double s, double t)
{
	double NR[3] = { 0.5*r*(r - 1.0), 0.5*r*(r + 1.0), 1.0 - r*r };
	double NS[3] = { 0.5*s*(s - 1.0), 0.5*s*(s + 1.0), 1.0 - s*s };
	double NT[3] = { 0.5*t*(t - 1.0), 0.5*t*(t + 1.0), 1.0 - t*t };

	double DR[3] = { r - 0.5, r + 0.5, -2.0*r };
	double DS[3] = { s - 0.5, s + 0.5, -2.0*s };
	double DT[3] = { t - 0.5, t + 0.5, -2.0*t };

	double HR[3] = { 1.0, 1.0, -2.0 };
	double HS[3] = { 1.0, 1.0, -2.0 };
	double HT[3] = { 1.0, 1.0, -2.0 };

	for (int a = 0; a<27; ++a)
	{
		int i = HEX27_LUT[a][0];
		int j = HEX27_LUT[a][1];
		int k = HEX27_LUT[a][2];

		Hrr[a] = HR[i] * NS[j] * NT[k];
		Hss[a] = NR[i] * HS[j] * NT[k];
		Htt[a] = NR[i] * NS[j] * HT[k];

		Hrs[a] = DR[i] * DS[j] * NT[k];
		Hst[a] = NR[i] * DS[j] * DT[k];
		Hrt[a] = DR[i] * NS[j] * DT[k];
	}
}